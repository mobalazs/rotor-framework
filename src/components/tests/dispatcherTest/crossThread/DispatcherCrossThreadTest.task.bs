' Rotor Framework Task
import "pkg:/source/RotorFrameworkTask.bs"

' Constants
import "pkg:/components/tests/dispatcherTest/DispatcherTest.const.bs"

' Model and Reducer for Dispatcher
import "pkg:/components/tests/dispatcherTest/DispatcherTest.dispatcher.bs"


sub init()
    m.top.functionName = "task"
    m.appFw = new Rotor.FrameworkTask({
        ' tasks: ["AnotherTask1", "AnotherTask2"] ' optional
    })


end sub

sub task()
    ' Create Foo Dispatcher (Owned by this Task)
    m.fooDispatcher = test.createFooDispatcher()

    ' Create Source Object Dispatcher (tests registerSourceObject with roDeviceInfo)
    m.sourceObjectDispatcher = test.createSourceObjectDispatcher()

    ' Create Transfer Dispatcher (tests identity-based registerSourceObject with roUrlTransfer)
    m.transferDispatcher = test.createTransferDispatcher()

    m.appFw.sync(100, sub()
        fw = m.rotor_framework_helper.frameworkInstance
        dispatcher = fw.dispatcherProvider.get("sourceObjectDispatcher")
        if dispatcher <> invalid
            dispatcher.dispatch({ type: "tick" })
        end if
    end sub)
end sub

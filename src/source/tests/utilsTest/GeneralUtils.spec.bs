namespace tests
    @suite("Rotor.Utils general helpers")
    class GeneralUtilsSuite extends rooibos.BaseTestSuite

        @describe("type guards")

        @it("isValid distinguishes valid and invalid values")
        function _()
            m.assertTrue(Rotor.Utils.isValid(0))
            m.assertFalse(Rotor.Utils.isValid(invalid))
        end function

        @it("isAssociativeArray reports associative arrays")
        function _()
            m.assertTrue(Rotor.Utils.isAssociativeArray({ key: true }))
            m.assertFalse(Rotor.Utils.isAssociativeArray([1, 2]))
        end function

        @it("isArray reports arrays correctly")
        function _()
            m.assertTrue(Rotor.Utils.isArray([1, 2]))
            m.assertFalse(Rotor.Utils.isArray({}))
        end function

        @it("isString reports string values")
        function _()
            m.assertTrue(Rotor.Utils.isString("hello"))
            m.assertFalse(Rotor.Utils.isString(5))
        end function

        @it("isFunction identifies callable values")
        function _()
            m.assertTrue(Rotor.Utils.isFunction(m.sampleFunction))
            m.assertFalse(Rotor.Utils.isFunction("notFunction"))
        end function

        @it("isInteger accepts integer types")
        function _()
            m.assertTrue(Rotor.Utils.isInteger(5))
            m.assertFalse(Rotor.Utils.isInteger(5.5))
        end function

        @it("isBoolean accepts boolean values")
        function _()
            m.assertTrue(Rotor.Utils.isBoolean(true))
            m.assertFalse(Rotor.Utils.isBoolean(0))
        end function

        @describe("math helpers")

        @it("min returns smallest numeric value")
        function _()
            m.assertEqual(Rotor.Utils.min(4, 9), 4)
        end function

        @it("min returns second argument when first is larger")
        function _()
            m.assertEqual(Rotor.Utils.min(10, 2), 2)
        end function

        @it("max returns largest numeric value")
        function _()
            m.assertEqual(Rotor.Utils.max(4, 9), 9)
        end function

        @it("max returns first argument when already greater")
        function _()
            m.assertEqual(Rotor.Utils.max(9, 4), 9)
        end function

        @it("rotateSegment rotates coordinates around center")
        function _()
            rotated = Rotor.Utils.rotateSegment(0, 0, 1, 0, 90, [0, 0])
            m.assertTrue(Abs(rotated.x1) < 0.0001)
            m.assertTrue(Abs(rotated.y1) < 0.0001)
            m.assertTrue(Abs(rotated.x2) < 0.0001)
            m.assertTrue(Abs(rotated.y2 + 1) < 0.0001)
        end function

        @describe("uuid helpers")

        @it("uuid generates expected id format")
        function _()
            uuid = Rotor.Utils.getUUID()
            m.assertEqual(uuid.Len(), 36)
            m.assertTrue(uuid.Instr("-") > -1)
        end function

        @it("uuidHex produces hex of requested length")
        function _()
            token = Rotor.Utils.getUUIDHex(6)
            m.assertEqual(token.Len(), 6)

            for each char in token.Split("")
                m.assertTrue(m.isHexChar(char))
            end for
        end function

        @describe("RALE logger helpers")

        @it("leftPad adds leading zeros")
        function _()
            m.assertEqual(Rotor.Utils.RALE_Logger__getZeroNumber(5), "05")
            m.assertEqual(Rotor.Utils.RALE_Logger__getZeroNumber(123), "123")
        end function

        @it("formatTime renders roDateTime time")
        function _()
            dt = m.createDateTime("2024-06-02T03:04:05Z")
            formatted = Rotor.Utils.RALE_Logger__GetTime(dt)
            m.assertEqual(formatted, "03:04:05.00")
        end function

        @it("formatTime trims millisecond precision correctly")
        function _()
            stub = {
                getHours: function() return 3 : end function,
                getMinutes: function() return 4 : end function,
                getSeconds: function() return 5 : end function,
                getMilliseconds: function() return 123 : end function
            }
            formatted = Rotor.Utils.RALE_Logger__GetTime(stub)
            m.assertEqual(formatted, "03:04:05.123")
        end function

        @it("formatDate renders roDateTime date")
        function _()
            dt = m.createDateTime("2024-06-02T00:00:00Z")
            formatted = Rotor.Utils.RALE_Logger__GetDate(dt)
            m.assertEqual(formatted, "06-02")
        end function

        @it("BasicLogger prints timestamped message under debug")
        function _()
            Rotor.Utils.BasicLogger("coverage-check")
        end function

        private function sampleFunction()
            return true
        end function

        private function isHexChar(char as string) as boolean
            return "0123456789ABCDEF".Instr(char) > -1
        end function

        private function createDateTime(isoString as string) as object
            dt = CreateObject("roDateTime")
            dt.FromISO8601String(isoString)
            return dt
        end function
    end class
end namespace
